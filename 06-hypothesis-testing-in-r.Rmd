---
title: "Hypothesis Testing in R"
author: 郭耀仁 Yao-Jen Kuo
date: "`r Sys.Date()`"
output:
  revealjs::revealjs_presentation:
    theme: night
    highlight: zenburn
    center: true
    reveal_options:
      self_contained: true
      previewLinks: true
      slideNumber: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# What is hypothesis testing

## Researchers retain or reject hypothesis based on measurements of observed samples

## To determine whether retain or reject is based on "hypothesis testing"

## How to state the hypotheses

- Null hypothesis: an assumption that is made about the larger population, denoted by $H_0$
- Alternative hypothesis: negates the null hypothesis, denoted by $H_1$ or $H_a$

## For example: Is my coin fair?

- Null hypothesis: there would be an equal number of occurrences of heads and tails if a coin is tossed several times(a fair coin!)
- Alternative hypothesis: the occurrences of heads and tails would have significant differences if a coin is tossed several times(an unfair coin!)

## Tossing a fair coin for 10000 times

```{r}
coin_toss <- rbinom(10000, 1, prob = 0.5)
```

## The $z$ statistic for proportion

$$
z = \frac{P_1 - P_0}{\sqrt{\frac{P_0(1-P_0)}{n}}}
$$

---

```{r}
n_of_heads <- sum(coin_toss)
p_heads <- n_of_heads / length(coin_toss)
p_0 <- 0.5
n <- length(coin_toss)
z <- (p_heads - p_0) / sqrt(p_0*(1-p_0)/n)
z
```

## The $z_{-\alpha/2}$ and $z_{\alpha/2}$

```{r}
alpha = .05
z_half_alpha <- qnorm(1 - alpha/2)
c(-z_half_alpha, z_half_alpha)
```

## Interpretation

The test statistic `r z` which lies between the critical values of `r -z_half_alpha` and `r z_half_alpha`. Hence, at .05 significance level, we do not reject the claim that our coin is fair. Say, our coin is fair.

## Tossing an unfair coin for 10000 times

```{r}
coin_toss <- rbinom(10000, 1, prob = 0.3)
```

## The $z$ statistic

```{r}
n_of_heads <- sum(coin_toss)
p_heads <- n_of_heads / length(coin_toss)
p_0 <- 0.5
n <- length(coin_toss)
z <- (p_heads - p_0) / sqrt(p_0*(1-p_0)/n)
z
```

## The $z_{-\alpha/2}$ and $z_{\alpha/2}$

```{r}
alpha = .05
z_half_alpha <- qnorm(1 - alpha/2)
c(-z_half_alpha, z_half_alpha)
```

## Interpretation

The test statistic `r z` which lies outside of the critical values of `r -z_half_alpha` and `r z_half_alpha`. Hence, at .05 significance level, we reject the claim that our coin is fair. Say, our coin is unfair.

# Types of error

## There are 2 types of error might occur after we decided to accept or reject null hypothesis

1. **Type I error**: falsely rejecting a TRUE $H_0$
2. **Type II error**: falsely accepting a FALSE $H_0$

## Understanding these 2 errors via confusion matrix

![Imgur](https://i.imgur.com/4uhdZqN.png)

## In confusion matrix

- Positive refers to rejecting hypothesis
- Negative refers to accepting hypothesis

## There are 4 possible combinations

1. TP: truly rejecting a FALSE $H_0$
2. TN: truly accepting a TRUE $H_0$
3. FP: falsely rejecting a TRUE $H_0$ **Type I error**
4. FN: falsely accepting a FALSE $H_0$ **Type II error**

# A Recap of Kaggle Dataset: Titanic

## Dataset description of Titanic

<https://www.kaggle.com/c/titanic>

## The Titanic dataset

```{r}
titanic <- read.csv("https://kaggle-getting-started.s3-ap-northeast-1.amazonaws.com/titanic/train.csv", stringsAsFactors = FALSE)
dim(titanic)
```

---

```{r}
summary(titanic)
```

## Removing rows with NAs

```{r}
titanic <- titanic[complete.cases(titanic), ]
dim(titanic)
```

---

```{r}
summary(titanic)
```

## Updating row indice

```{r}
row.names(titanic) <- NULL
```

## The Built-In `var()` and `sd()` Functions uses denominator of `n-1`

```{r eval=FALSE}
?var
?sd
```

## Creating our own functions for population variance and standard deviation

```{r}
population_var <- function(x) {
  n <- length(x)
  mu <- mean(x)
  error <- x - mu
  squared_error <- error**2
  sum_squared_error <- sum(squared_error)
  return(sum_squared_error / n)
}

population_sd <- function(x) {
  pop_var <- population_var(x)
  return(sqrt(pop_var))
}
```

## Getting our samples

```{r}
set.seed(87)
row_indice <- as.numeric(rownames(titanic))
sampled_row_indice <- sample(row_indice, size = 30)
sampled_titanic <- titanic[sampled_row_indice, ]
sample_mean_age <- mean(sampled_titanic$Age)
sample_mean_age
```

# Lower Tail Test of Population Mean with Known Variance

## Null hypothesis of the lower tail test of the population mean

$$\mu \ge \mu_0$$

## The test statistic $z$

$$z = \frac{\bar{x} - \mu_0}{\sigma/\sqrt{n}}$$

The null hypothesis of the lower tail test is to be rejected if $z \le -z_{\alpha}$

## The picture of lower tail test

![Imgur](https://i.imgur.com/o3LTTUv.png)

## Problem

Suppose the historian claims that the mean age of Titanic passengers is older than 40 years old. In a sample of 30 passengers, it was found that they are `r sample_mean_age` years old on average. At .05 significance level, can we reject the claim by the historian?

## Solution

```{r}
x_bar <- sample_mean_age
mu_0 <- 40
sigma <- population_sd(titanic$Age)
n <- 30
z <- (x_bar - mu_0)/(sigma/sqrt(n))
z
```

---

```{r}
alpha <- .05
z_alpha <- qnorm(1 - alpha)
-z_alpha
```

## Interpretation

The test statistic `r z` is less than the critical value of `r -z_alpha`. Hence, at .05 significance level, we reject the claim that mean age of Titanic passengers is older than 40 years old.

# Upper Tail Test of Population Mean with Known Variance

## Null hypothesis of the upper tail test of the population mean

$$\mu \le \mu_0$$

## The test statistic $z$

$$z = \frac{\bar{x} - \mu_0}{\sigma/\sqrt{n}}$$

The null hypothesis of the upper tail test is to be rejected if $z \ge z_{\alpha}$

## The picture of upper tail test

![Imgur](https://i.imgur.com/XtHHVRx.png)

## Problem

Suppose the historian claims that the mean age of Titanic passengers is younger than 20 years old. In a sample of 30 passengers, it was found that they are `r sample_mean_age` years old on average. At .05 significance level, can we reject the claim by the historian?

## Solution

```{r}
x_bar <- sample_mean_age
mu_0 <- 20
sigma <- population_sd(titanic$Age)
n <- 30
z <- (x_bar - mu_0)/(sigma/sqrt(n))
z
```

---

```{r}
alpha <- .05
z_alpha <- qnorm(1 - alpha)
z_alpha
```

## Interpretation

The test statistic `r z` is greater than the critical value of `r z_alpha`. Hence, at .05 significance level, we reject the claim that mean age of Titanic passengers is younger than 20 years old.

# Two-Tailed Test of Population Mean with Known Variance

## Null hypothesis of the two-tailed test of the population mean

$$\mu = \mu_0$$

## The test statistic $z$

$$z = \frac{\bar{x} - \mu_0}{\sigma/\sqrt{n}}$$

The null hypothesis of the two-tailed test is to be rejected if $z \le -z_{\alpha/2}$ or $z \ge z_{\alpha/2}$

## The picture of two-tailed test

![Imgur](https://i.imgur.com/L0VaONz.png)

## Problem

Suppose the historian claims that the mean age of Titanic passengers in a sample of 30 passengers is the same as population, it was found that they are `r sample_mean_age` years old on average. At .05 significance level, can we reject the claim by the historian?

## Solution

```{r}
x_bar <- sample_mean_age
mu_0 <- mean(titanic$Age)
sigma <- population_sd(titanic$Age)
n <- 30
z <- (x_bar - mu_0)/(sigma/sqrt(n))
z
```

---

```{r}
alpha <- .05
z_half_alpha <- qnorm(1 - alpha/2)
c(-z_half_alpha, z_half_alpha)
```

## Interpretation

The test statistic `r z` which lies between the critical values of `r -z_half_alpha` and `r z_half_alpha`. Hence, at .05 significance level, we do not reject the claim that the sample mean age of Titanic passengers is the same as population.

# Lower Tail Test of Population Mean with Unknown Variance

## Null hypothesis of the lower tail test of the population mean

$$\mu \ge \mu_0$$

## The test statistic $t$

$$t = \frac{\bar{x} - \mu_0}{s/\sqrt{n}}$$

The null hypothesis of the lower tail test is to be rejected if $t \le -t_{\alpha}$

## The picture of lower tail test

![Imgur](https://i.imgur.com/1v6uAur.png?1)

## Problem

Suppose the historian claims that the mean age of Titanic passengers is older than 40 years old. In a sample of 30 passengers, it was found that they are `r sample_mean_age` years old on average. At .05 significance level, can we reject the claim by the historian?

## Solution

```{r}
x_bar <- sample_mean_age
mu_0 <- 40
s <- sd(sampled_titanic$Age)
n <- 30
t <- (x_bar - mu_0)/(s/sqrt(n))
t
```

---

```{r}
alpha <- .05
t_alpha <- qt(1 - alpha, df = n - 1)
-t_alpha
```

## Interpretation

The test statistic `r t` is less than the critical value of `r -t_alpha`. Hence, at `r alpha` significance level, we reject the claim that mean age of Titanic passengers is older than 40 years old.

# Upper Tail Test of Population Mean with Unknown Variance

## Null hypothesis of the upper tail test of the population mean

$$\mu \le \mu_0$$

## The test statistic $t$

$$t = \frac{\bar{x} - \mu_0}{s/\sqrt{n}}$$

The null hypothesis of the upper tail test is to be rejected if $t \ge t_{\alpha}$

## The picture of upper tail test

![Imgur](https://i.imgur.com/XRrWr4Z.png)

## Problem

Suppose the historian claims that the mean age of Titanic passengers is younger than 20 years old. In a sample of 30 passengers, it was found that they are `r sample_mean_age` years old on average. At .05 significance level, can we reject the claim by the historian?

## Solution

```{r}
x_bar <- sample_mean_age
mu_0 <- 20
s <- sd(sampled_titanic$Age)
n <- 30
t <- (x_bar - mu_0)/(s/sqrt(n))
t
```

---

```{r}
alpha <- .05
t_alpha <- qt(1 - alpha, df = n - 1)
t_alpha
```

## Interpretation

The test statistic `r t` is greater than the critical value of `r t_alpha`. Hence, at .05 significance level, we reject the claim that mean age of Titanic passengers is younger than 20 years old.

# Two-Tailed Test of Population Mean with Unknown Variance

## Null hypothesis of the two-tailed test of the population mean

$$\mu = \mu_0$$

## The test statistic $t$

$$t = \frac{\bar{x} - \mu_0}{s/\sqrt{n}}$$

The null hypothesis of the two-tailed test is to be rejected if $t \le -t_{\alpha/2}$ or $t \ge t_{\alpha/2}$

## The picture of two-tailed test

![Imgur](https://i.imgur.com/QeHUcqr.png)

## Problem

Suppose the historian claims that the mean age of Titanic passengers in a sample of 30 passengers is the same as population, it was found that they are `r sample_mean_age` years old on average. At .05 significance level, can we reject the claim by the historian?

## Solution

```{r}
x_bar <- sample_mean_age
mu_0 <- mean(titanic$Age)
s <- sd(sampled_titanic$Age)
n <- 30
t <- (x_bar - mu_0)/(s/sqrt(n))
t
```

---

```{r}
alpha <- .05
t_half_alpha <- qt(1 - alpha/2, df = n - 1)
c(-t_half_alpha, t_half_alpha)
```

## Interpretation

The test statistic `r t` which lies between the critical values of `r -t_half_alpha` and `r t_half_alpha`. Hence, at .05 significance level, we do not reject the claim that the sample mean age of Titanic passengers is the same as population.